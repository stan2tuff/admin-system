<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: white; padding: 20px; }
        .grid { display: grid; grid-template-columns: 300px 1fr; gap: 20px; }
        .card { background: #1e1e1e; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #333; }
        .player-item { padding: 10px; border-bottom: 1px solid #333; cursor: pointer; transition: 0.2s; }
        .player-item:hover { background: #2a2a2a; color: #00a2ff; }
        .btn-group button { margin: 5px; padding: 8px; cursor: pointer; border-radius: 4px; border: none; color: white; }
        input, textarea { width: 100%; background: #333; color: white; border: none; padding: 8px; margin: 5px 0; box-sizing: border-box; }
        #logBox { font-family: monospace; color: #00ff00; height: 100px; overflow-y: auto; background: #000; padding: 10px; }
    </style>
</head>
<body>
    <div class="grid">
        <div class="card">
            <h3>Online Players</h3>
            <div id="playerList">Loading players...</div>
        </div>

        <div>
            <div class="card">
                <h3>Actions for: <span id="selectedUser" style="color:#00a2ff">None</span></h3>
                <div class="btn-group">
                    <button style="background:#ff4444" onclick="doAction('kick')">Kick</button>
                    <button style="background:#ff9900" onclick="doAction('kill')">Kill</button>
                    <button style="background:#00a2ff" onclick="doAction('warn')">Warn</button>
                </div>
                <input type="text" id="warnMsg" placeholder="Warning reason (for Warn only)">
                <input type="password" id="pw" placeholder="Admin Key (1234)">
            </div>

            <div class="card">
                <h3>Global Announcement</h3>
                <textarea id="globalMsg" placeholder="Message..."></textarea>
                <button style="background:#00a2ff; width:100%; color:white; border:none; padding:10px;" onclick="doAction('announce')">Broadcast</button>
            </div>

            <div class="card">
                <h3>Live Logs</h3>
                <div id="logBox"></div>
            </div>
        </div>
    </div>

    <script>
        let selectedPlayer = "";

        async function refreshData() {
            const res = await fetch('/get-data');
            const d = await res.json();
            
            // Update Player List
            const pList = document.getElementById('playerList');
            pList.innerHTML = d.players.length ? "" : "No players online.";
            d.players.forEach(p => {
                const div = document.createElement('div');
                div.className = "player-item";
                div.innerText = p;
                div.onclick = () => { selectedPlayer = p; document.getElementById('selectedUser').innerText = p; };
                pList.appendChild(div);
            });

            // Update Logs
            document.getElementById('logBox').innerHTML = d.logs.join("<br>");
        }
        setInterval(refreshData, 5000);

        async function doAction(type) {
            const payload = {
                password: document.getElementById('pw').value,
                type: type,
                target: selectedPlayer,
                message: type === 'announce' ? document.getElementById('globalMsg').value : document.getElementById('warnMsg').value
            };

            const res = await fetch('/set-command', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(payload)
            });
            if (!res.ok) alert("Failed! Check password.");
        }
    </script>
</body>
</html>
